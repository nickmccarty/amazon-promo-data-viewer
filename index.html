<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Sheets Table</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
  <h1 class="text-center mb-4">Google Sheets Table</h1>

  <div class="d-flex justify-content-between mb-3">
    <input type="text" class="form-control w-50" id="search" placeholder="üîç Search...">
    <label>
      <input type="checkbox" onclick="toggleDarkMode()"> üåô Dark Mode
    </label>
  </div>

  <div id="loading" class="text-center my-4">
    <div class="spinner-border text-primary" role="status"></div>
    <p>Loading...</p>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-bordered table-hover">
      <thead class="table-dark">
        <tr id="table-header"></tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>

  <div class="d-flex justify-content-center mt-3">
    <button class="btn btn-primary me-2" onclick="prevPage()">‚¨ÖÔ∏è Prev</button>
    <button class="btn btn-primary" onclick="nextPage()">Next ‚û°Ô∏è</button>
  </div>
</div>

<script>
  const sheetURL = "https://docs.google.com/spreadsheets/d/1YanpcSEESAFJufqBxAilCl5nmlZjRuq2Mph98ZivR1I/gviz/tq?tqx=out:csv";
  const tableHeader = document.getElementById("table-header");
  const tableBody = document.getElementById("table-body");
  const searchInput = document.getElementById("search");
  const loading = document.getElementById("loading");

  let allRows = [];
  let currentPage = 1;
  const rowsPerPage = 5;

  document.addEventListener("DOMContentLoaded", async () => {
    try {
      const response = await fetch(sheetURL);
      const csv = await response.text();
      const rows = parseCSV(csv);

      allRows = rows.slice(1);
      renderTableHeaders(rows[0]);
      renderTable();
    } catch (error) {
      console.error("Failed to fetch data:", error);
      tableBody.innerHTML = `<tr><td colspan="100%" class="text-center text-danger">Failed to load data</td></tr>`;
    } finally {
      loading.style.display = "none";
    }
  });

  function parseCSV(csv) {
    const lines = csv.split("\n");
    return lines.map(line =>
      line.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)?.map(cell =>
        cell.replace(/^"|"$/g, "").trim()
      ) || []
    );
  }

  function renderTableHeaders(headers) {
    headers.forEach(header => {
      const th = document.createElement("th");
      th.textContent = header;
      tableHeader.appendChild(th);
    });
  }

  function renderTable() {
    tableBody.innerHTML = "";
    const filteredRows = filterRows();
    const start = (currentPage - 1) * rowsPerPage;
    const end = start + rowsPerPage;
    const paginatedRows = filteredRows.slice(start, end);

    paginatedRows.forEach(row => {
      const tr = document.createElement("tr");
      row.forEach(cell => {
        const td = document.createElement("td");
        td.textContent = cell;
        tr.appendChild(td);
      });
      tableBody.appendChild(tr);
    });
  }

  function filterRows() {
    const query = searchInput.value.toLowerCase();
    return allRows.filter(row => row.some(cell => cell.toLowerCase().includes(query)));
  }

  searchInput.addEventListener("keyup", () => {
    currentPage = 1;
    renderTable();
  });

  function prevPage() {
    if (currentPage > 1) {
      currentPage--;
      renderTable();
    }
  }

  function nextPage() {
    const maxPage = Math.ceil(filterRows().length / rowsPerPage);
    if (currentPage < maxPage) {
      currentPage++;
      renderTable();
    }
  }

  function toggleDarkMode() {
    document.body.classList.toggle("bg-dark");
    document.body.classList.toggle("text-white");
    document.querySelector(".table").classList.toggle("table-dark");
  }
</script>

</body>
</html>
